---
title: "Semantic Overlap Computation"
author: "Kanishka Misra, Hemanth Devarapalli"
date: "1/22/2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(wordVectors)

errors <- read_csv("../data/experiment_final.csv")
english_vectors <- read.vectors("../data/pretrained_embeddings/cc.en.300.vec", binary = F)
russian_vectors <- read.vectors("../data/pretrained_embeddings/cc.ru.vec", binary = F)

```

## Learner Errors in English

In this example, we consider an error annotated corpus of 1244 short essays, each written by a unique learner of english belonging to one of 16 different first languages (L1).

Since we are covering semantic errors, we extract the errors made in content words (adjectives (J), nouns (N), verbs (V) and adverbs (Y)).

```{r}
example <- errors %>% filter(c == "acquiring", i == "getting")

eng_incorrect <- example$i
eng_correct <- example$c
ru_incorrect <- example$l1_i
ru_correct <- example$l1_c

closest_words <- function(word, vector_space, n = 10) {
  vectors <- vector_space[word, ]
  closest <- closest_to(vector_space, vectors, n = n + 1) %>%
    slice(-1)
  return(closest$word)
}

cosine_similarity <- function(word1, word2, vector_space = glove_vectors) {
  sim <- cosineSimilarity(vector_space[word1, ], vector_space[word2, ])
  return(as.double(sim))
}

semantic_overlap <- function(word1, word2, n = 10, vector_space) {
  cat(paste0("word1: ", word1, ", word2: ", word2), sep = "\n")
  word1_neighbors = closest_words(word1, n = n, vector_space = vector_space)
  word2_neighbors = closest_words(word2, n = n, vector_space = vector_space)
  
  neighbor1_vectors <- vector_space[word1_neighbors, ]
  neighbor2_vectors <- vector_space[word2_neighbors, ]
  
  overlap1 = mean(cosineSimilarity(neighbor1_vectors, vector_space[word2, ]))
  overlap2 = mean(cosineSimilarity(neighbor2_vectors, vector_space[word1, ]))
  
  overlap = mean(c(overlap1, overlap2))
  
  return(overlap)
}

english_vectors <- read.vectors("../../pretrained_vectors/fasttext/wiki-news-300d-1M-subword.vec", binary = F)

fasttex_wiki_eng <- tibble(
  word = c(eng_correct, eng_incorrect),
  type = c("c", "i")
) %>%
  mutate(nearest = map(word, closest_words, vector_space = english_vectors))

fasttex_wiki_eng %>% select(-type) %>% spread(word, nearest) %>% unnest() %>% write_csv("../data/examples/fasttext_wiki_eng.csv")

fasttex_cc_eng <- tibble(
  word = c(eng_correct, eng_incorrect),
  type = c("c", "i")
) %>%
  mutate(nearest = map(word, closest_words, vector_space = english_vectors))

fasttex_cc_eng %>% select(-type) %>% spread(word, nearest) %>% unnest() %>% write_csv("../data/examples/fasttext_cc_eng.csv")

rm(english_vectors)
english_vectors <- read.vectors("../../pretrained_vectors/GoogleNews-vectors-negative300.bin")

word2vec_cc_eng <- tibble(
  word = c(eng_correct, eng_incorrect),
  type = c("c", "i")
) %>%
  mutate(nearest = map(word, closest_words, vector_space = english_vectors))

word2vec_cc_eng %>% select(-type) %>% spread(word, nearest) %>% unnest() %>% write_csv("../data/examples/word2vec_cc_eng.csv")

rm(english_vectors)

russian_cc <- tibble(
  word = c(ru_correct, ru_incorrect),
  type = c("c", "i")
) %>%
  mutate(nearest = map(word, closest_words, vector_space = russian_vectors))

russian_cc %>% select(-type) %>% spread(word, nearest) %>% unnest() %>% write_csv("../data/examples/fasttext_cc_ru.csv")
```


Let's look at an example by a learner whose L1 is Russian:

```{r}

```

Incorrect word in English: `acquiring` Replacement as annotated: `getting`

```{r}

```

Translated form: `приобретения` Translated replacement: `получение`




